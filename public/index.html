<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Note Synchronizer</title>
  <script src="https://cdn.jsdelivr.net/npm/jsdom@16.4.0/lib/api.min.js"></script>
</head>
<style>
  *{
    box-sizing: border-box;
  }
  textarea{
    width:100%;
    height: 300px;
    padding: 5px;
  }

  input{
    width:100%;
    padding: 5px;
  }

  input, textarea, pre{
    border: 1px solid #ccc;
    display:block;
    margin-bottom: 5px;
  }
  body{
    display: flex;
  }
  #formParseBody, #formSyncToDrive{
    flex-grow: 1;
    border: 1px solid black;
    padding: 10px;
  }
</style>
<body>
  <form id="formParseBody" onsubmit="parseBody(); return false">
    <input id='input-message-id-to-parse' placeholder="Message ID" value="10f4697640f6e6d6"/>
    <textarea id='output-raw-html' placeholder="Raw HTML"></textarea>
    <textarea id='output-parsed-html' placeholder="Parsed HTML"></textarea>
  </form>
  <form id="formSyncToDrive" onsubmit="syncToDrive(); return false">
    <input id='input-message-id-to-sync' placeholder="Message ID" value="10f4697640f6e6d6"/>
  </form>
</body>
<script>
  async function parseBody(){
    const messageId = document.querySelector('#input-message-id-to-parse').value;
    if(messageId.length >= 16 && messageId.length < 20){
      const result = await fetch(`/api/message/parse/${messageId}`).then(res => res.json());
      document.querySelector('#output-raw-html').value = result.raw;
      document.querySelector('#output-parsed-html').value = result.parsed_text;
    }
  }

  let syncInProgress = false;
  async function syncToDrive(){
    if(syncInProgress){
      return;
    }
    const messageId = document.querySelector('#input-message-id-to-sync').value;
    if(messageId.length >= 16 && messageId.length < 20){
      syncInProgress = true;
      try{
      const result = await fetch(`/api/message/sync/${messageId}`).then(res => res.json());
      alert(JSON.stringify(result, null, 2))
      } catch(err){}
      syncInProgress = false;
    }
  }
</script>
</html>
